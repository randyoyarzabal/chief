# Chief v3.1.1 Release Notes

## üöÄ What's New in v3.1.1

### üîß Function Naming Convention Standardization

All plugin functions now use consistent hyphen notation following the pattern `chief.<plugin>_<word>-<word>` for better readability and consistency across the entire codebase.

### üÜï New SSL Renewal Feature

- **`chief.ssl_renew-tls-cert`** - Smart certificate renewal with automatic parameter extraction
  - Auto-detects CA from existing certificate issuer
  - Preserves all original certificate parameters (Subject, SAN, extensions)
  - Expiry checking and validation (`--check-expiry`)
  - Optional backup creation (`--backup`)
  - New key generation support (`--new-key`)
  - Force renewal option (`--force`)

### üöÄ Enhanced OpenShift Login

Major enhancements to **`chief.oc_login`** for managing multiple clusters from Vault:

- **`-l, --list`** - Interactive cluster selection with numbered menu
  - Lists all clusters from `${CHIEF_VAULT_OC_PATH}`
  - Prompts user to select cluster for login
  - Works with all authentication methods (-kc, -ka, user)

- **`--list-only`** - Non-interactive cluster listing  
  - Perfect for scripting and quick reference
  - Shows all available clusters without prompting
  - Includes helpful usage examples

- **`-f, --filter PATTERN`** - Filter clusters by patterns
  - Supports wildcards: `'ocp*'`, `'prod*'`, `'*dev*'`
  - Works with both interactive and non-interactive modes
  - Shows filtered vs total counts

**Examples:**
```bash
chief.oc_login -l                    # Interactive selection
chief.oc_login --list-only           # Just list clusters  
chief.oc_login -l -f 'ocp*'          # List only 'ocp*' clusters
chief.oc_login --list-only -f 'prod*' # List only production clusters
```

### üÜï New OpenShift Information Function

**`chief.oc_whoami`** - Comprehensive cluster information display:

- **Current User**: Shows authenticated user identity
- **API Server**: Displays OpenShift API server URL  
- **Console Address**: Shows web console URL (if available)
- **Context**: Shows current kubectl/oc context name
- **Login Validation**: Confirms active authentication status

**Options:**
- `-q, --quiet` - Minimal output (user and server only)
- `-j, --json` - Machine-readable JSON output format
- `-?` - Comprehensive help documentation

**Examples:**
```bash
chief.oc_whoami              # Full cluster information
chief.oc_whoami -q           # Minimal output  
chief.oc_whoami -j           # JSON format for scripting
```

**JSON Output Format:**
```json
{
  "logged_in": true,
  "user": "username", 
  "server": "https://api.cluster.com:6443",
  "console": "https://console.cluster.com",
  "context": "context-name"
}
```

This function provides instant visibility into your current OpenShift session, perfect for scripts that need to verify cluster connectivity or for users managing multiple clusters.

### üéØ Help System Standardization

**Consistent Help Options** across all OpenShift functions:

- **`-?` and `--help`** - Both options now work identically on all functions
- **Standardized Format** - All usage texts show both help options
- **Argument Parsing** - All functions accept both short and long form help

**Functions Updated:**
- `chief.oc_get-all-objects`
- `chief.oc_clean-olm` 
- `chief.oc_clean-replicasets`
- `chief.oc_approve-csrs`
- `chief.oc_show-stuck-resources`
- `chief.oc_login`
- `chief.oc_delete-stuck-ns`
- `chief.oc_whoami`

This ensures consistency across the entire plugin and follows best practices for command-line tool help systems.

### üîí Security Improvement

**Kubeconfig Path Security Fix** for `chief.oc_login -kc`:

- **Issue**: Previously used `/tmp/kubeconfig` which could have permission conflicts between users
- **Fix**: Now uses `~/.tmp/kubeconfig` (user-specific temporary directory)
- **Benefits**:
  - No permission conflicts between different users
  - Secure directory permissions (700) and file permissions (600)
  - User-owned files that are always removable by the owner
  - Better isolation between user sessions

## üî• BREAKING CHANGES

**Function Naming Convention Standardization (34 functions renamed)**  
All plugin functions now use consistent hyphen notation following the pattern `chief.<plugin>_<word>-<word>`:

### SSL Plugin (5 functions)

- `chief.ssl_create_ca` ‚Üí `chief.ssl_create-ca`
- `chief.ssl_create_tls_cert` ‚Üí `chief.ssl_create-tls-cert`
- `chief.ssl_view_cert` ‚Üí `chief.ssl_view-cert`
- `chief.ssl_get_cert` ‚Üí `chief.ssl_get-cert`
- **NEW:** `chief.ssl_renew-tls-cert` (certificate renewal)

### SSH Plugin (3 functions)

- `chief.ssh_rm_host` ‚Üí `chief.ssh_rm-host`
- `chief.ssh_get_publickey` ‚Üí `chief.ssh_get-publickey`
- `chief.ssh_create_keypair` ‚Üí `chief.ssh_create-keypair`

### Python Plugin (4 functions)

- `chief.python_ve_dep` ‚Üí `chief.python_ve-dep`
- `chief.python_create_ve` ‚Üí `chief.python_create-ve`
- `chief.python_start_ve` ‚Üí `chief.python_start-ve`
- `chief.python_stop_ve` ‚Üí `chief.python_stop-ve`

### OpenShift Plugin (6 functions + major enhancements)

- `chief.oc_get_all_objects` ‚Üí `chief.oc_get-all-objects`
- `chief.oc_clean_olm` ‚Üí `chief.oc_clean-olm`
- `chief.oc_clean_replicasets` ‚Üí `chief.oc_clean-replicasets`
- `chief.oc_approve_csrs` ‚Üí `chief.oc_approve-csrs`
- `chief.oc_show_stuck_resources` ‚Üí `chief.oc_show-stuck-resources`
- `chief.oc_delete_stuck_ns` ‚Üí `chief.oc_delete-stuck-ns`
- **ENHANCED:** `chief.oc_login` - Added Vault cluster management with interactive/non-interactive listing and filtering

### Git Plugin (7 functions)

- `chief.git_rename_branch` ‚Üí `chief.git_rename-branch`
- `chief.git_delete_tag` ‚Üí `chief.git_delete-tag`
- `chief.git_delete_branch` ‚Üí `chief.git_delete-branch`
- `chief.git_cred_cache` ‚Üí `chief.git_cred-cache`
- `chief.git_set_url` ‚Üí `chief.git_set-url`
- `chief.git_config_user` ‚Üí `chief.git_config-user`

### Etc Plugin (8 functions)

- `chief.etc_create_bootusb` ‚Üí `chief.etc_create-bootusb`
- `chief.etc_copy_dotfiles` ‚Üí `chief.etc_copy-dotfiles`
- `chief.etc_create_cipher` ‚Üí `chief.etc_create-cipher`
- `chief.etc_mount_share` ‚Üí `chief.etc_mount-share`
- `chief.etc_folder_diff` ‚Üí `chief.etc_folder-diff`
- `chief.etc_at_run` ‚Üí `chief.etc_at-run`
- `chief.etc_isvalid_ip` ‚Üí `chief.etc_isvalid-ip`
- `chief.etc_folder_sync` ‚Üí `chief.etc_folder-sync`
- `chief.etc_ask_yes_or_no` ‚Üí `chief.etc_ask-yes-or-no`
- `chief.type_writer` ‚Üí `chief.type-writer`

### AWS Plugin (2 functions)

- `chief.aws_set_role` ‚Üí `chief.aws_set-role`
- `chief.aws_export_creds` ‚Üí `chief.aws_export-creds`

## üìã Migration Guide

**Update Required:** All scripts, aliases, or documentation that reference the old underscore notation must be updated to use the new hyphen notation.

**Pattern:** The new convention matches existing functions like `chief.vault_file-edit` for consistency across all plugins.

**Examples:**

```bash
# OLD (will not work)
chief.ssl_create_ca mycompany
chief.python_start_ve myproject
chief.oc_get_all_objects mynamespace

# NEW (correct syntax)
chief.ssl_create-ca mycompany  
chief.python_start-ve myproject
chief.oc_get-all-objects mynamespace

# NEW: Enhanced cluster management (v3.1.1)
chief.oc_login -l                    # Interactive cluster selection
chief.oc_login --list-only -f 'ocp*' # List filtered clusters
```

## üõ†Ô∏è Technical Improvements

### Test Suite Enhancements

- **Fixed plugin function detection** - Updated regex patterns to properly detect functions with hyphens
- **Improved test output** - Suppressed unnecessary "Failed: 0" messages when all tests pass
- **Enhanced function discovery** - Resolved "No functions/aliases found: vault" warnings

### Documentation Updates

- **Comprehensive reference updates** - All plugin summaries, examples, and cross-references updated
- **Consistent naming throughout** - README.md, docs/index.md, and release notes all use new naming
- **Updated usage examples** - All function calls in documentation use new hyphen convention

## üîß Post-Release Fixes (Re-release)

### Completed Implementation Issues

- **Issue**: Original v3.1.1 release had incomplete implementation of naming convention changes
- **Impact**: `chief.bash_profile`, `chief.bashrc`, `chief.profile` functions were broken with "command not found" errors
- **Root Cause**: Function definitions were updated but internal function calls still used old underscore naming
- **Fix Applied**: Updated all missed function calls to use correct hyphen naming convention
- **Functions Restored**: All shell configuration editing functions now work correctly

### Remote Plugins Update Process Fixed

- **Issue**: `chief.plugins_update` would create directory structure before validating git access, leading to orphaned directories when access failed
- **Impact**: Users with invalid repository URLs or access issues would get "directory already exists" errors on subsequent attempts
- **Solution**: 
  - Added git access validation **before** any filesystem changes using `git ls-remote`
  - Implemented automatic backup of existing local `~/chief_plugins` directories with timestamps
  - Reordered operations to validate ‚Üí backup ‚Üí create ‚Üí clone for safer execution
- **Benefits**:
  - Early failure detection prevents orphaned directories
  - Local plugin work is automatically preserved with timestamped backups
  - Clear error messages guide users to resolve access issues
  - No more "directory already exists" clone failures

### Improved Warning Message Handling
- **Issue**: Nagging "Remote plugins are not set to auto-update" warning appeared even when verbose output was disabled
- **Impact**: Users with intentionally quiet configurations (verbose=false) still saw unwanted warnings  
- **Fix Applied**: Warning now respects `CHIEF_CFG_VERBOSE` setting and only appears when verbose output is enabled
- **Improvement**: Added "Warning:" prefix to make the message less alarming and more informative

---

**Status:** Released  
**Release Date:** v3.1.1  
**Breaking Changes:** Yes - Function naming convention (migration required)  
**New Features:** SSL certificate renewal + Enhanced OpenShift cluster management + New oc_whoami function + Help system standardization + Security improvements
